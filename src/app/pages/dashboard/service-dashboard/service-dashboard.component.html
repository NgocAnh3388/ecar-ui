<div class="grid grid-cols-12 gap-4 md:gap-6">
    <div class="col-span-12">
        <div class="col-span-12 xl:col-span-7">
            <div
                    class="overflow-hidden rounded-2xl border border-gray-200 bg-white dark:border-white/[0.05] dark:bg-white/[0.03]"
            >
                <div class="px-4 pt-4 sm:px-6">
                    <div
                            class="flex flex-col gap-2 mb-4 sm:flex-row sm:items-center sm:justify-between"
                    >
                        <div>
                            <h3
                                    class="text-lg font-semibold text-gray-800 dark:text-white/90"
                            >
                                Recent Orders
                            </h3>
                        </div>

                        <div class="relative" (keydown.escape)="open=false">
                            <button
                                    (click)="toggleDropdown($event)"
                                    class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-theme-sm font-medium text-gray-700 shadow-theme-xs hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-white/[0.03] dark:hover:text-gray-200"
                                    aria-haspopup="listbox"
                                    [attr.aria-expanded]="open"
                            >
                                <svg
                                        class="stroke-current fill-white dark:fill-gray-800"
                                        width="20"
                                        height="20"
                                        viewBox="0 0 20 20"
                                >
                                    <path
                                            d="M2.29 5.903H17.707"
                                            stroke=""
                                            stroke-width="1.5"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                    />
                                    <path
                                            d="M17.707 14.096H2.291"
                                            stroke=""
                                            stroke-width="1.5"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                    />
                                    <path
                                            d="M12.083 3.333a2.57 2.57 0 110 5.142 2.57 2.57 0 010-5.142Z"
                                            fill=""
                                            stroke=""
                                            stroke-width="1.5"
                                    />
                                    <path
                                            d="M7.917 11.525a2.57 2.57 0 100 5.141 2.57 2.57 0 000-5.141Z"
                                            fill=""
                                            stroke=""
                                            stroke-width="1.5"
                                    />
                                </svg>
                                <span>
                  {{ selected.size ? (selected.size + ' selected') :
                  'Filter options' }}
                </span>
                                <svg
                                        class="ml-1 h-4 w-4"
                                        viewBox="0 0 20 20"
                                        fill="currentColor"
                                >
                                    <path
                                            d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
                                    />
                                </svg>
                            </button>

                            <div
                                    *ngIf="open"
                                    class="absolute right-0 top-full z-[999] mt-2 w-72 rounded-xl border border-gray-200 bg-white p-3 shadow-lg dark:border-white/10 dark:bg-gray-900"
                                    (click)="$event.stopPropagation()"
                                    role="listbox"
                            >
                                <div
                                        class="mb-2 flex items-center justify-between gap-2"
                                >
                                    <button
                                            type="button"
                                            class="px-2 py-1 text-xs rounded-md hover:bg-gray-100 dark:hover:bg-white/10"
                                            (click)="selectAll()"
                                    >
                                        Select all
                                    </button>
                                    <button
                                            type="button"
                                            class="px-2 py-1 text-xs rounded-md hover:bg-gray-100 dark:hover:bg-white/10"
                                            (click)="clearAll()"
                                    >
                                        Clear
                                    </button>
                                </div>

                                <div class="max-h-64 overflow-auto pr-1">
                                    <label
                                            *ngFor="let opt of options; trackBy: trackByKey"
                                            class="flex items-start gap-2 rounded-lg px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-white/10 cursor-pointer"
                                    >
                                        <input
                                                type="checkbox"
                                                class="mt-0.5 h-4 w-4 rounded border-gray-300 dark:border-gray-600"
                                                [checked]="isChecked(opt.key)"
                                                (change)="toggle(opt.key, $event)"
                                        />
                                        <span
                                                class="text-sm text-gray-700 dark:text-gray-200"
                                        >{{ opt.label }}</span
                                        >
                                    </label>
                                </div>

                                <div class="mt-3 flex justify-end gap-2">
                                    <button
                                            type="button"
                                            class="px-3 py-2 text-sm rounded-lg text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-white/10"
                                            (click)="open=false"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                            type="button"
                                            class="px-3 py-2 text-sm rounded-lg bg-gray-900 text-white hover:bg-black/80 dark:bg-white dark:text-gray-900 dark:hover:bg-white/90"
                                            (click)="apply()"
                                    >
                                        Apply
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="max-w-full overflow-x-auto min-h-[500px]">
                    <table class="w-full">
                        <thead
                                class="border-gray-100 border-y dark:border-white/[0.05]"
                        >
                        <tr>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Customer Name</th>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Car Model</th>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">License Plate</th>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Center</th>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Service</th>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Appointment</th>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Technician</th>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Status</th>
                            <th class="px-4 py-3 font-medium text-gray-500 sm:px-6 text-start text-theme-xs dark:text-gray-400">Actions</th>
                        </tr>
                        </thead>

                        <tbody class="divide-y divide-gray-100 dark:divide-white/[0.05]">
                        <tr *ngFor="let item of tickets; index as i">
                            <td class="px-4 py-3 font-medium text-gray-800 sm:px-6 text-start text-theme-sm dark:text-white/90">
                                {{ item.customerName }}
                            </td>
                            <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">{{ item.carName }}</td>
                            <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">{{ item.licensePlate }}</td>
                            <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">{{ item.centerName }}</td>
                            <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">{{ getService(item) }}</td>
                            <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">{{ item.scheduleTime }} {{ item.scheduleDate | date: 'dd-MM-yyyy' }}</td>
                            <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">{{ item.technicianName }}</td>
                            <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">{{ getStatus(item.status) }}</td>
                            <td class="px-4 py-3 text-gray-500 sm:px-6 text-start text-theme-sm dark:text-gray-400">
                                <div class="flex items-center gap-2">
                                    <!-- Nút Sửa -->
                                    <button
                                            (click)="onDetail(item.id, item.carModelId, item.numOfKm, item.technicianId, item.scheduleId)"
                                            title="Sửa"
                                            type="button"
                                            class="inline-flex items-center gap-1.5 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 hover:text-gray-800 shadow-theme-xs dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-white/[0.06]"
                                    >
                                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25Zm2.92 2.83H5v-.92l9.06-9.06.92.92L5.92 20.08ZM20.71 7.04c.39-.39.39-1.02 0-1.41L18.37 3.3a1 1 0 0 0-1.41 0l-1.34 1.34 3.75 3.75 1.34-1.35Z"/>
                                        </svg>
                                    </button>

                                    <!-- Nút Hủy -->
                                    <button *ngIf="item.isMaintenance && item.status !== 'DONE'"
                                            title="Cancel"
                                            type="button"
                                            (click)="onCancel(item.id)"
                                            class="inline-flex items-center gap-1.5 rounded-lg border border-yellow-300 bg-yellow-50 px-3 py-1.5 text-xs font-medium text-yellow-800 hover:bg-yellow-100 hover:text-yellow-900 shadow-theme-xs dark:border-yellow-400/30 dark:bg-yellow-500/10 dark:text-yellow-300 dark:hover:bg-yellow-500/20">
                                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                            <path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm3.707 12.293-1.414 1.414L12 13.414l-2.293 2.293-1.414-1.414L10.586 12 8.293 9.707l1.414-1.414L12 10.586l2.293-2.293 1.414 1.414L13.414 12Z"/>
                                        </svg>
                                        Cancel Order
                                    </button>

                                    <!-- Nếu bị hủy -->
                                    <span *ngIf="!item.isMaintenance" class="text-red-500 font-semibold">Cancelled</span>

                                    <button *ngIf="!item.isMaintenance"
                                            (click)="onReopen(item.id)"
                                            class="inline-flex items-center gap-1.5 rounded-lg border border-blue-300 bg-blue-50 px-3 py-1.5 text-xs font-medium text-blue-700 hover:bg-blue-100 hover:text-blue-900 shadow-theme-xs">
                                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                            <path d="M12 2a10 10 0 1 0 10 10A10.011 10.011 0 0 0 12 2Zm-1 5h2v6h-2Zm0 8h2v2h-2Z"/>
                                        </svg>
                                        Reactivate Order
                                    </button>

                                    <!-- Nút Hoàn thành -->
                                    <button *ngIf="item.status === 'TECHNICIAN_RECEIVED' && item.isMaintenance"
                                            (click)="onComplete(item.id)"
                                            title="Hoàn thành"
                                            type="button"
                                            class="inline-flex items-center gap-1.5 rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-1.5 text-xs font-medium text-emerald-700 shadow-theme-xs transition hover:bg-emerald-100 hover:text-emerald-800 dark:border-emerald-400/30 dark:bg-emerald-500/10 dark:text-emerald-300 dark:hover:bg-emerald-500/20">
                                        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                            <path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div *ngIf="tickets.length === 0" class="flex items-center justify-center h-full text-center p-10">
                        <p class="text-gray-500 dark:text-gray-400">No orders found. Try adjusting your filters or clearing them.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
