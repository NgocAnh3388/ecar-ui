<div class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]">

    <!-- Header & Filter Section -->
    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-8">
        <div>
            <h3 class="text-lg font-semibold text-gray-800 dark:text-white/90">
                Profit & Revenue Report
            </h3>
            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                Calculate revenue based on subscription packages and expenses.
            </p>
        </div>

        <!-- Date Filter -->
        <div class="flex flex-col sm:flex-row gap-3">
            <div class="flex flex-col">
                <label class="text-xs text-gray-500 mb-1">Start Date</label>
                <input
                        type="date"
                        [(ngModel)]="startDate"
                        (ngModelChange)="startDate = $event"
                        class="rounded-lg border border-gray-300 px-3 py-2 text-sm"
                />
            </div>
            <div class="flex flex-col">
                <label class="text-xs text-gray-500 mb-1">End Date</label>
                <input
                        type="date"
                        [(ngModel)]="endDate"
                        (ngModelChange)="endDate = $event"
                        class="rounded-lg border border-gray-300 px-3 py-2 text-sm"
                />
            </div>
            <div class="flex items-end">
                <button
                        (click)="fetchData()"
                        [disabled]="isLoading"
                        class="rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50 transition-colors h-[38px]">
                    {{ isLoading ? 'Loading...' : 'Apply Filter' }}
                </button>
            </div>
        </div>
    </div>

    <!-- Error Alert -->
    <div *ngIf="errorMessage" class="mb-6 rounded-lg bg-red-50 p-4 text-sm text-red-500 dark:bg-red-900/20">
        {{ errorMessage }}
    </div>

    <!-- Statistics Cards Grid -->
    <div *ngIf="reportData" class="grid grid-cols-1 gap-6 sm:grid-cols-3">

        <!-- Card 1: Revenue -->
        <div class="rounded-xl border border-gray-100 bg-gray-50 p-5 dark:border-gray-700 dark:bg-gray-800">
            <div class="flex items-center gap-3 mb-3">
                <div class="flex h-10 w-10 items-center justify-center rounded-full bg-green-100 text-green-600 dark:bg-green-500/20 dark:text-green-400">
                    <!-- Icon Dollar -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                </div>
                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Revenue</span>
            </div>
            <h4 class="text-2xl font-bold text-gray-800 dark:text-white">
                {{ formatCurrency(reportData.totalRevenue) }}
            </h4>
            <p class="mt-1 text-xs text-green-600 flex items-center gap-1">
                From subscription sales
            </p>
        </div>

        <!-- Card 2: Expenses -->
        <div class="rounded-xl border border-gray-100 bg-gray-50 p-5 dark:border-gray-700 dark:bg-gray-800">
            <div class="flex items-center gap-3 mb-3">
                <div class="flex h-10 w-10 items-center justify-center rounded-full bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-400">
                    <!-- Icon Trending Down -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></svg>
                </div>
                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Expense</span>
            </div>
            <h4 class="text-2xl font-bold text-gray-800 dark:text-white">
                {{ formatCurrency(reportData.totalExpense) }}
            </h4>
            <p class="mt-1 text-xs text-red-500 flex items-center gap-1">
                Operational costs
            </p>
        </div>

        <!-- Card 3: Net Profit -->
        <div class="rounded-xl border p-5 bg-white dark:bg-gray-800 transition-all shadow-sm"
             [ngClass]="{
        'border-blue-500 ring-1 ring-blue-500': reportData.netProfit >= 0,
        'border-red-500 ring-1 ring-red-500': reportData.netProfit < 0
      }">
            <div class="flex items-center gap-3 mb-3">
                <div class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 text-blue-600 dark:bg-blue-500/20 dark:text-blue-400">
                    <!-- Icon Pie Chart -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>
                </div>
                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Net Profit</span>
            </div>
            <h4 class="text-2xl font-bold" [ngClass]="reportData.netProfit >= 0 ? 'text-blue-600' : 'text-red-600'">
                {{ formatCurrency(reportData.netProfit) }}
            </h4>
            <p class="mt-1 text-xs text-gray-500">
                Revenue - Expenses
            </p>
        </div>

    </div>

    <!-- ĐƯA BIỂU ĐỒ RA NGOÀI GRID ĐỂ FULL WIDTH -->
    <div class="mt-6">
        <app-monthly-sales-chart [chartData]="salesChartData"></app-monthly-sales-chart>
    </div>

</div>
