<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5>User Info</h5>
        <!-- <CHANGE> Thêm nút Edit/Save/Cancel -->
        <div *ngIf="!isEditMode">
            <button class="btn btn-sm btn-primary" (click)="enableEdit()">
                <i class="fas fa-edit"></i> Edit
            </button>
        </div>
        <div *ngIf="isEditMode" class="d-flex gap-2">
            <button
                    class="btn btn-sm btn-success"
                    (click)="saveChanges()"
                    [disabled]="isSaving"
            >
                <i class="fas fa-check"></i> {{ isSaving ? 'Saving...' : 'Save' }}
            </button>
            <button
                    class="btn btn-sm btn-secondary"
                    (click)="cancelEdit()"
                    [disabled]="isSaving"
            >
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    </div>
    <div class="card-body">
        <form>
            <!-- Full Name -->
            <div class="mb-3">
                <label for="fullName" class="form-label">Full Name</label>
                <input
                        type="text"
                        id="fullName"
                        name="fullName"
                        [ngModel]="isEditMode ? editData.fullName : user.fullName"
                        (ngModelChange)="isEditMode && (editData.fullName = $event)"
                        class="form-control"
                        [readonly]="!isEditMode"
                />
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input
                        type="email"
                        id="email"
                        name="email"
                        [ngModel]="isEditMode ? editData.email : user.email"
                        (ngModelChange)="isEditMode && (editData.email = $event)"
                        class="form-control"
                        [readonly]="!isEditMode"
                />
            </div>

            <!-- Phone Number -->
            <div class="mb-3">
                <label for="phoneNo" class="form-label">Phone Number</label>
                <input
                        type="text"
                        id="phoneNo"
                        name="phoneNo"
                        [ngModel]="isEditMode ? editData.phoneNo : user.phoneNo"
                        (ngModelChange)="isEditMode && (editData.phoneNo = $event)"
                        class="form-control"
                        [readonly]="!isEditMode"
                />
            </div>
        </form>
    </div>
</div>

<!-- Vehicles List -->
<div class="card mt-4" *ngIf="user.vehicles && user.vehicles.length > 0">
    <div class="card-header">
        <h5>Vehicles</h5>
    </div>
    <div class="card-body">
        <div
                *ngFor="let vehicle of user.vehicles; let i = index"
                class="border rounded p-3 mb-3"
        >
            <h6 class="fw-bold mb-2">Vehicle #{{ i + 1 }}</h6>
            <div class="row">
                <div class="col-md-6 mb-2">
                    <strong>License Plate:</strong> {{ vehicle.licensePlate }}
                </div>
                <div class="col-md-6 mb-2">
                    <strong>VIN:</strong> {{ vehicle.vinNumber }}
                </div>
                <div class="col-md-6 mb-2">
                    <strong>Model:</strong> {{ vehicle.carModel?.carName }}
                </div>
                <div class="col-md-6 mb-2">
                    <strong>Type:</strong> {{ vehicle.carModel?.carType }}
                </div>
                <div class="col-md-6 mb-2">
                    <strong>Next Maintenance Km:</strong> {{ vehicle.nextKm || 'N/A' }}
                </div>
                <div class="col-md-6 mb-2">
                    <strong>Next Maintenance Date:</strong> {{ vehicle.nextDate || 'N/A' }}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- No vehicles -->
<div class="alert alert-secondary mt-3" *ngIf="user.vehicles?.length === 0">
    This user has no registered vehicles.
</div>